<!-- miniprogram/pages/dashboard/dashboard.wxml -->
<view class="dashboard-container">
  <!-- åŠ è½½çŠ¶æ€ -->
  <view wx:if="{{isLoading}}" class="loading">
    <text>æ•°æ®åŠ è½½ä¸­...</text>
  </view>

  <!-- ä¸»è¦å†…å®¹ -->
  <view wx:else class="dashboard-content">
    <!-- é¡¶éƒ¨ç»Ÿè®¡å¡ç‰‡ -->
    <view class="stats-cards">
      <view class="stat-card">
        <text class="stat-value">{{dashboardData.totalCarbonEmitted}}g</text>
        <text class="stat-label">ç´¯è®¡ç¢³æ’æ”¾é‡</text>
      </view>
      <view class="stat-card">
        <text class="stat-value">{{dashboardData.equivalentTrees}}</text>
        <text class="stat-label">ç›¸å½“äºç§æ ‘</text>
      </view>
      <view class="stat-card">
        <text class="stat-value">{{dashboardData.recentRecords.length}}</text>
        <text class="stat-label">æ€»è®°å½•æ•°</text>
      </view>
    </view>

    <!-- åˆ†ç±»å æ¯” - ç®€åŒ–ç‰ˆ -->
    <view class="section">
      <view class="section-title">ç¢³æ’æ”¾åˆ†ç±»</view>
      <view wx:if="{{dashboardData.categoryData.length === 0}}" class="empty-state">
        <text>æš‚æ— åˆ†ç±»æ•°æ®ï¼Œå¿«å»æ·»åŠ è®°å½•å§ï¼</text>
      </view>
      <view wx:else class="category-list">
        <view wx:for="{{dashboardData.categoryData}}" wx:key="category" class="category-item">
          <text class="category-name">{{item.category}}</text>
          <text class="category-amount">{{item.amount}}g</text>
        </view>
      </view>
    </view>

    <!-- æœ€è¿‘è®°å½• -->
    <view class="section">
      <view class="section-header">
        <text class="section-title">æœ€è¿‘è®°å½•</text>
        <button class="add-btn" bindtap="navigateToRecord">+ æ·»åŠ è®°å½•</button>
      </view>
      
      <view wx:if="{{dashboardData.recentRecords.length === 0}}" class="empty-state">
        <text>æš‚æ— è®°å½•ï¼Œå¿«å»æ·»åŠ ç¬¬ä¸€æ¡ç¢³è¶³è¿¹å§ï¼</text>
      </view>

      <view wx:else class="records-list">
        <view wx:for="{{dashboardData.recentRecords}}" wx:key="_id" class="record-item">
          <view class="record-main">
            <text class="record-desc">{{item.description}}</text>
            <text class="record-amount">{{item.carbonAmount}}g</text>
          </view>
          <view class="record-meta">
            <text class="record-type">{{item.recordType}}</text>
            <text class="record-time">{{formatTime(item.createdAt)}}</text>
          </view>
          <view wx:if="{{item.aiFeedback}}" class="ai-feedback">
            <text>ğŸ’¡ {{item.aiFeedback}}</text>
          </view>
        </view>
      </view>
    </view>
  </view>
</view>